include $(top_srcdir)/config/common.am

CLEANFILES += $(UIFILES:%.ui=ui_%.h)
CLEANFILES += $(MOCEDFILES)

BUILT_SOURCES = $(UIFILES:%.ui=ui_%.h)
BUILT_SOURCES += $(MOCEDFILES)
BUILT_SOURCES += Resources.cpp Resources.qrc

#########################  Qt stuff  #############################
# Use _() for localization instead of tr() or trUtf8()
UIC4FLAGS=-tr lyx::qt_

ui_%.h: ui/%.ui
	$(UIC4) $(UIC4FLAGS) $< -o $@

MOCEDFILES = $(MOCHEADER:%.h=%_moc.cpp)

%_moc.cpp: %.h
	$(MOC4) -o $@ $<

Resources.qrc: Makefile
	echo "<!DOCTYPE RCC><RCC version='1.0'><qresource>" > $@
	find $(top_srcdir)/lib/images -name '*.png' \
		| sed -e 's:$(top_srcdir)/lib/\(.*\):<file alias="\1">&</file>:' \
		>> $@
	echo "</qresource></RCC>" >> $@

Resources.cpp: Resources.qrc
	$(RCC4) $< -name Resources -o $@


#########################  LIBRARIES  #############################

noinst_LTLIBRARIES = liblyxqt4.la

liblyxqt4_la_DEPENDENCIES = $(MOCEDFILES)
liblyxqt4_la_LDFLAGS = $(QT4_LDFLAGS)
liblyxqt4_la_LIBADD = $(QT4_LIB) 

AM_CPPFLAGS += \
	$(QT4_CPPFLAGS) \
	-I$(top_srcdir)/src \
	-I$(top_srcdir)/src/frontends \
	-I$(top_srcdir)/images \
	$(QT4_INCLUDES) $(BOOST_INCLUDES)

SOURCEFILES = \
	ButtonPolicy.cpp \
	ButtonPolicy.h \
	Dialog.cpp \
	Dialog.h \
	Resources.cpp \
	Action.cpp \
	BulletsModule.cpp \
	ButtonController.cpp \
	ColorCache.cpp \
	CustomizedWidgets.cpp \
	EmptyTable.cpp \
	FileDialog.cpp \
	FloatPlacement.cpp \
	GuiAbout.cpp \
	GuiAlert.cpp \
	GuiApplication.cpp \
	GuiBibitem.cpp \
	GuiBibtex.cpp \
	GuiBox.cpp \
	GuiBranch.cpp \
	GuiBranches.cpp \
	GuiChanges.cpp \
	GuiCharacter.cpp \
	GuiCitation.cpp \
	GuiClipboard.cpp \
	GuiCommandBuffer.cpp \
	GuiCommandEdit.cpp \
	GuiDelimiter.cpp \
	GuiDialog.cpp \
	GuiDocument.cpp \
	GuiErrorList.cpp \
	GuiERT.cpp \
	GuiExternal.cpp \
	GuiFloat.cpp \
	GuiFontExample.cpp \
	GuiFontLoader.cpp \
	GuiFontMetrics.cpp \
	GuiGraphics.cpp \
	GuiHyperlink.cpp \
	GuiImage.cpp \
	GuiInclude.cpp \
	GuiIndex.cpp \
	GuiKeySymbol.cpp \
	GuiListings.cpp \
	GuiLog.cpp \
	GuiMath.cpp \
	GuiMathMatrix.cpp \
	GuiMenubar.cpp \
	GuiNomencl.cpp \
	GuiNote.cpp \
	GuiPainter.cpp \
	GuiParagraph.cpp \
	GuiPopupMenu.cpp \
	GuiPrefs.cpp \
	GuiPrint.cpp \
	GuiRef.cpp \
	GuiSearch.cpp \
	GuiSelection.cpp \
	GuiSelectionManager.cpp \
	GuiSendto.cpp \
	GuiSetBorder.cpp \
	GuiShowFile.cpp \
	GuiSpellchecker.cpp \
	GuiTabular.cpp \
	GuiTabularCreate.cpp \
	GuiTexinfo.cpp \
	GuiThesaurus.cpp \
	GuiToc.cpp \
	GuiToolbar.cpp \
	GuiToolbars.cpp \
	GuiView.cpp \
	GuiViewSource.cpp \
	GuiVSpace.cpp \
	GuiWorkArea.cpp \
	GuiWrap.cpp \
	IconPalette.cpp \
	InsertTableWidget.cpp \
	LengthCombo.cpp \
	LyXFileDialog.cpp \
	LaTeXHighlighter.cpp \
	PanelStack.cpp \
	qt_helpers.cpp \
	TocModel.cpp \
	TocWidget.cpp \
	Validator.cpp 

NOMOCHEADER = \
	ButtonController.h \
	DialogView.h \
	GuiFontLoader.h \
	GuiFontMetrics.h \
	GuiImage.h \
	GuiMath.h \
	GuiPainter.h \
	GuiToolbars.h \
	qt_helpers.h

MOCHEADER = \
	Action.h \
	BulletsModule.h \
	ColorCache.h \
	CustomizedWidgets.h \
	DockView.h \
	EmptyTable.h \
	FloatPlacement.h \
	GuiAbout.h \
	GuiApplication.h \
	GuiBibitem.h \
	GuiBibtex.h \
	GuiBox.h \
	GuiBranches.h \
	GuiBranch.h \
	GuiChanges.h \
	GuiCharacter.h \
	GuiCitation.h \
	GuiClipboard.h \
	GuiCommandBuffer.h \
	GuiCommandEdit.h \
	GuiDelimiter.h \
	GuiDialog.h \
	GuiDocument.h \
	GuiErrorList.h \
	GuiERT.h \
	GuiExternal.h \
	GuiFloat.h \
	GuiFontExample.h \
	GuiGraphics.h \
	GuiHyperlink.h \
	GuiInclude.h \
	GuiIndex.h \
	GuiKeySymbol.h \
	GuiListings.h \
	GuiLog.h \
	GuiMathMatrix.h \
	GuiMenubar.h \
	GuiNomencl.h \
	GuiNote.h \
	GuiParagraph.h \
	GuiPopupMenu.h \
	GuiPrefs.h \
	GuiPrint.h \
	GuiRef.h \
	GuiSearch.h \
	GuiSelection.h \
	GuiSelectionManager.h \
	GuiSendto.h \
	GuiSetBorder.h \
	GuiShowFile.h \
	GuiSpellchecker.h \
	GuiTabularCreate.h \
	GuiTabular.h \
	GuiTexinfo.h \
	GuiThesaurus.h \
	GuiToc.h \
	GuiToolbar.h \
	GuiView.h \
	GuiViewSource.h \
	GuiVSpace.h \
	GuiWorkArea.h \
	GuiWrap.h \
	IconPalette.h \
	InsertTableWidget.h \
	LengthCombo.h \
	LyXFileDialog.h \
	LaTeXHighlighter.h \
	PanelStack.h \
	qlkey.h \
	TocModel.h \
	TocWidget.h \
	Validator.h

UIFILES = \
	AboutUi.ui \
	AskForTextUi.ui \
	BibitemUi.ui \
	BiblioUi.ui \
	BibtexAddUi.ui \
	BibtexUi.ui \
	BoxUi.ui \
	BranchesUi.ui \
	BranchUi.ui \
	BulletsUi.ui \
	ChangesUi.ui \
	CharacterUi.ui \
	CitationUi.ui \
	DelimiterUi.ui \
	DocumentUi.ui \
	ErrorListUi.ui \
	ERTUi.ui \
	ExternalUi.ui \
	EmbeddedFilesUi.ui \
	FloatPlacementUi.ui \
	FloatUi.ui \
	FontUi.ui \
	GraphicsUi.ui \
	HyperlinkUi.ui \
	IncludeUi.ui \
	IndexUi.ui \
	LanguageUi.ui \
	LaTeXUi.ui \
	ListingsUi.ui \
	LogUi.ui \
	MarginsUi.ui \
	MathMatrixUi.ui \
	MathsUi.ui \
	NomenclUi.ui \
	NoteUi.ui \
	NumberingUi.ui \
	PageLayoutUi.ui \
	ParagraphUi.ui \
	PDFSupportUi.ui \
	PreambleUi.ui \
	PrefColorsUi.ui \
	PrefConvertersUi.ui \
	PrefDateUi.ui \
	PrefDisplayUi.ui \
	PrefFileformatsUi.ui \
	PrefIdentityUi.ui \
	PrefKeyboardUi.ui \
	PrefLanguageUi.ui \
	PrefLatexUi.ui \
	PrefPathsUi.ui \
	PrefPlaintextUi.ui \
	PrefPrinterUi.ui \
	PrefScreenFontsUi.ui \
	PrefShortcutsUi.ui \
	PrefSpellcheckerUi.ui \
	PrefsUi.ui \
	PrefUi.ui \
	PrintUi.ui \
	RefUi.ui \
	SearchUi.ui \
	SendtoUi.ui \
	ShortcutUi.ui \
	ShowFileUi.ui \
	SpellcheckerUi.ui \
	TabularCreateUi.ui \
	TabularUi.ui \
	TexinfoUi.ui \
	TextLayoutUi.ui \
	ThesaurusUi.ui \
	TocUi.ui \
	ViewSourceUi.ui \
	VSpaceUi.ui \
	WrapUi.ui


if MONOLITHIC_FRONTEND_QT4


liblyxqt4.cpp:
	@echo -e '$(SOURCEFILES:%=\n#include "%")\n' > $@

liblyxqt4_la_SOURCES = \
	liblyxqt4.cpp \
	$(MOCHEADER) \
	$(NOMOCHEADER)

BUILT_SOURCES += liblyxqt4.cpp

else

liblyxqt4.cpp:
	touch $@

liblyxqt4_la_SOURCES = \
	$(SOURCEFILES) \
	$(MOCHEADER) \
	$(NOMOCHEADER)

EXTRA_DIST = pch.h
BUILT_SOURCES += $(PCH_FILE)
AM_CPPFLAGS += $(PCH_FLAGS)


endif
