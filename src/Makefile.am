include $(top_srcdir)/config/common.am

DISTCLEANFILES += config.h libintl.h version.C stamp-version version.C-tmp

MAINTAINERCLEANFILES += $(srcdir)/config.h.in

if BUILD_CLIENT_SUBDIR
CLIENT = client
endif

SUBDIRS = mathed insets graphics support frontends . $(CLIENT) tex2lyx

EXTRA_DIST = config.h.in stamp-h.in version.C.in \
	Sectioning.h \
	Sectioning.C \
	Variables.C \
	Variables.h \
	paper.h \
	pch.h

LYX_PRE_LIBS = mathed/libmathed.la insets/libinsets.la \
	frontends/libfrontends.la

LYX_POST_LIBS = frontends/controllers/libcontrollers.la \
	graphics/libgraphics.la \
	support/libsupport.la

BOOST_LIBS = $(BOOST_REGEX) $(BOOST_SIGNALS) $(BOOST_FILESYSTEM) $(BOOST_IOSTREAMS)

OTHERLIBS = $(BOOST_LIBS) $(INTLLIBS) $(AIKSAURUS_LIBS) @LIBS@ $(SOCKET_LIBS)

bin_PROGRAMS = lyx
noinst_PROGRAMS = $(FRONTENDS_PROGS)
EXTRA_PROGRAMS = lyx-xforms lyx-qt lyx-gtk lyx-qt4

lyx_xforms_LDADD = $(lyx_OBJECTS) $(LYX_PRE_LIBS) \
	frontends/xforms/libxforms.la $(LYX_POST_LIBS) $(OTHERLIBS)

lyx_xforms_SOURCES = main.C

lyx_qt_LDADD = $(lyx_OBJECTS) $(LYX_PRE_LIBS) \
	frontends/qt2/libqt2.la $(LYX_POST_LIBS) $(OTHERLIBS)
lyx_qt_SOURCES = main.C

lyx_qt4_LDADD = $(lyx_OBJECTS) $(LYX_PRE_LIBS) \
	frontends/qt4/libqt4.la $(LYX_POST_LIBS) $(OTHERLIBS)
lyx_qt4_SOURCES = main.C

lyx_gtk_LDADD = $(lyx_OBJECTS) $(LYX_PRE_LIBS) \
	frontends/gtk/libgtk.la $(LYX_POST_LIBS) $(OTHERLIBS)
lyx_gtk_SOURCES = main.C

lyx$(EXEEXT): $(FRONTENDS_PROGS)
	rm -f $@
	$(LN_S) $< $@

#lyx_LDFLAGS=-Wl,-O1

BUILT_SOURCES = $(PCH_FILE) version.C

AM_CPPFLAGS += $(PCH_FLAGS) $(BOOST_INCLUDES)

if USE_ASPELL
ASPELL = aspell.C aspell_local.h
endif
if USE_PSPELL
PSPELL = pspell.C pspell.h
endif
if USE_ISPELL
ISPELL = ispell.C ispell.h
endif



lyx_SOURCES = \
	Bidi.C \
	Bidi.h \
	BufferView.C \
	BufferView.h \
	BufferView_pimpl.C \
	BufferView_pimpl.h \
	Bullet.C \
	Bullet.h \
	BranchList.C \
	BranchList.h \
	Chktex.C \
	Chktex.h \
	Color.C \
	Color.h \
	CutAndPaste.C \
	CutAndPaste.h \
	DepTable.C \
	DepTable.h \
	FloatList.C \
	FloatList.h \
	Floating.C \
	Floating.h \
	FontIterator.C \
	FontIterator.h \
	FuncStatus.C \
	FuncStatus.h \
	InsetList.C \
	InsetList.h \
	LColor.C \
	LColor.h \
	LaTeX.C \
	LaTeX.h \
	LaTeXFeatures.C \
	LaTeXFeatures.h \
	LyXAction.C \
	LyXAction.h \
	MenuBackend.C \
	MenuBackend.h \
	ParagraphList.h \
	ParagraphList_fwd.h \
	ParagraphParameters.C \
	ParagraphParameters.h \
	PrinterParams.C \
	PrinterParams.h \
	RowList_fwd.h \
	Spacing.C \
	Spacing.h \
	Thesaurus.C \
	Thesaurus.h \
	ToolbarBackend.C \
	ToolbarBackend.h \
	WordLangTuple.h \
	author.C \
	author.h \
	boost.C \
	box.h \
	box.C \
	buffer.C \
	buffer.h \
	buffer_funcs.C \
	buffer_funcs.h \
	bufferlist.C \
	bufferlist.h \
	bufferparams.C \
	bufferparams.h \
	bufferview_funcs.C \
	bufferview_funcs.h \
	changes.C \
	changes.h \
	chset.C \
	chset.h \
	config.h.in \
	converter.C \
	converter.h \
	counters.C \
	counters.h \
	coordcache.C \
	coordcache.h \
	cursor.C \
	cursor.h \
	cursor_slice.C \
	cursor_slice.h \
	debug.C \
	debug.h \
	dimension.C \
	dimension.h \
	dociterator.C \
	dociterator.h \
	dispatchresult.h \
	encoding.C \
	encoding.h \
	errorlist.C \
	errorlist.h \
	exporter.C \
	exporter.h \
	gettext.C \
	gettext.h \
	factory.h \
	factory.C \
	format.C \
	format.h \
	funcrequest.h \
	funcrequest.C \
	graph.C \
	graph.h \
	importer.C \
	importer.h \
	intl.C \
	intl.h \
	insetiterator.C \
	insetiterator.h \
	kbmap.C \
	kbmap.h \
	kbsequence.C \
	kbsequence.h \
	language.C \
	language.h \
	session.C \
	session.h \
	layout.h \
	lengthcommon.C \
	lengthcommon.h \
	lfuns.h \
	lyx_cb.C \
	lyx_cb.h \
	lyx_main.C \
	lyx_main.h \
	lyx_sty.C \
	lyx_sty.h \
	lyxfont.C \
	lyxfont.h \
	lyxfind.C \
	lyxfind.h \
	lyxfunc.C \
	lyxfunc.h \
	lyxgluelength.C \
	lyxgluelength.h \
	lyxlayout.C \
	lyxlayout.h \
	lyxlayout_ptr_fwd.h \
	lyxlength.C \
	lyxlength.h \
	lyxlex.C \
	lyxlex.h \
	lyxlex_pimpl.C \
	lyxlex_pimpl.h \
	lyxrc.C \
	lyxrc.h \
	lyxrow.C \
	lyxrow.h \
	lyxrow_funcs.C \
	lyxrow_funcs.h \
	lyxserver.C \
	lyxserver.h \
	lyxsocket.C \
	lyxsocket.h \
	lyxtext.h \
	lyxtextclass.C \
	lyxtextclass.h \
	lyxtextclasslist.C \
	lyxtextclasslist.h \
	lyxvc.C \
	lyxvc.h \
	messages.C \
	messages.h \
	metricsinfo.C \
	metricsinfo.h \
	mover.C \
	mover.h \
	output.C \
	output.h \
	outputparams.C \
	outputparams.h \
	output_docbook.C \
	output_docbook.h \
	output_latex.C \
	output_latex.h \
	output_linuxdoc.C \
	output_linuxdoc.h \
	output_plaintext.C \
	output_plaintext.h \
	paper.h \
	paragraph.C \
	paragraph.h \
	paragraph_funcs.C \
	paragraph_funcs.h \
	paragraph_pimpl.C \
	paragraph_pimpl.h \
	pariterator.C \
	pariterator.h \
	$(ASPELL) $(PSPELL) $(ISPELL) SpellBase.C \
	SpellBase.h \
	rowpainter.C \
	rowpainter.h \
	sgml.C \
	sgml.h \
	tabular.C \
	tabular.h \
	tex-accent.C \
	tex-accent.h \
	tex-strings.C \
	tex-strings.h \
	texrow.C \
	texrow.h \
	text.C \
	text2.C \
	text3.C \
	toc.C \
	toc.h \
	trans.C \
	trans.h \
	trans_decl.h \
	trans_mgr.C \
	trans_mgr.h \
	undo.C \
	undo.h \
	vc-backend.C \
	vc-backend.h \
	version.C \
	version.h \
	vspace.C \
	vspace.h

version.C: stamp-version
	@:

stamp-version: version.C-tmp
	if cmp -s $< version.C ; then \
		: ;\
	else \
		rm -f version.C ;\
		cp $< version.C ;\
	fi
	echo timestamp > $@
